<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lifestyle AI - Your Personal Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #fce7d8;
            color: #212121;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            overflow-x: hidden;
        }

        /* Background Decoration */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .decoration-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.08;
        }

        .circle-1 {
            width: 12rem;
            height: 12rem;
            background: linear-gradient(135deg, #ff8c42, #ff6b00);
            top: 5%;
            right: 10%;
            animation: float 6s ease-in-out infinite;
        }

        .circle-2 {
            width: 8rem;
            height: 8rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            bottom: 15%;
            left: 8%;
            animation: float 8s ease-in-out infinite reverse;
        }

        .circle-3 {
            width: 6rem;
            height: 6rem;
            background: linear-gradient(135deg, #ff8c42, #ff6b00);
            top: 60%;
            left: 15%;
            opacity: 0.04;
            animation: float 10s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 60rem;
            position: relative;
            z-index: 1;
        }

        /* Chat Card - Increased Size */
        .chat-card {
            background: #FFFFFF;
            border-radius: 2rem;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.08), 
                0 10px 30px rgba(0, 0, 0, 0.04),
                0 0 0 1px rgba(224, 224, 224, 0.3);
            overflow: hidden;
            transition: all 0.3s ease;
            height: 90vh; /* Fixed dashboard height */
            max-height: 650px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        /* Chat Header */
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(238, 238, 238, 0.8);
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.02), rgba(255, 255, 255, 0.8));
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            border-radius: 0.75rem;
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.3);
        }

        .logo-icon {
            width: 1.5rem;
            height: 1.5rem;
            color: #FFFFFF;
        }

        .brand-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #212121;
            margin-bottom: 0.125rem;
            letter-spacing: -0.025em;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            color: #9E9E9E;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .history-btn, .profile-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .history-btn {
            background: rgba(255, 107, 0, 0.1);
            border: 2px solid rgba(255, 107, 0, 0.2);
        }

        .history-btn:hover {
            background: rgba(255, 107, 0, 0.2);
            transform: scale(1.05);
        }

        .history-btn svg {
            width: 1.25rem;
            height: 1.25rem;
            color: #ff6b00;
        }

        .profile-icon {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.1), rgba(255, 107, 0, 0.05));
            border: 2px solid rgba(255, 107, 0, 0.2);
        }

        .profile-svg {
            width: 1.25rem;
            height: 1.25rem;
            color: #ff6b00;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background: linear-gradient(180deg, rgba(249, 249, 249, 0.3) 0%, rgba(255, 255, 255, 0.8) 100%);
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(238, 238, 238, 0.3);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(158, 158, 158, 0.4);
            border-radius: 3px;
        }

        /* Welcome Message */
        .welcome-message {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            animation: slideUp 0.6s ease-out;
        }

        .bot-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        .bot-avatar svg {
            width: 1.25rem;
            height: 1.25rem;
            color: #FFFFFF;
        }

        .message-content {
            background: #FFFFFF;
            padding: 1.5rem;
            border-radius: 1.25rem 1.25rem 1.25rem 0.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(238, 238, 238, 0.8);
            max-width: 85%;
        }

        .message-content h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #212121;
            margin-bottom: 0.5rem;
        }

        .message-content p {
            font-size: 0.875rem;
            color: #616161;
            line-height: 1.5;
        }

        /* Chat Messages */
        .message {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            animation: messageSlide 0.4s ease-out;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message-avatar.bot {
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            box-shadow: 0 2px 8px rgba(255, 107, 0, 0.3);
        }

        .message-avatar.user {
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            box-shadow: 0 2px 8px rgba(255, 107, 0, 0.3);
        }

        .message-avatar svg {
            width: 1rem;
            height: 1rem;
            color: #FFFFFF;
        }

        .message-bubble {
            max-width: 75%;
            padding: 1rem 1.25rem;
            border-radius: 1.25rem;
            font-size: 0.875rem;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
        }

        .message-bubble.bot {
            background: #FFFFFF;
            color: #212121;
            border: 1px solid rgba(238, 238, 238, 0.8);
            border-radius: 1.25rem 1.25rem 1.25rem 0.5rem;
        }

        .message-bubble.user {
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            color: #FFFFFF;
            border-radius: 1.25rem 1.25rem 0.5rem 1.25rem;
        }
        
        /* New Styles for Reminder Type Selection */
        .reminder-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .reminder-option {
            flex: 1;
            min-width: 8rem;
            position: relative;
        }

        .reminder-input {
            appearance: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .reminder-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(224, 224, 224, 0.2);
            border: 2px solid rgba(224, 224, 224, 0.8);
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #616161;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reminder-input:checked + .reminder-label {
            background: rgba(255, 107, 0, 0.1);
            border-color: #ff6b00;
            color: #ff6b00;
            box-shadow: 0 4px 8px rgba(255, 107, 0, 0.1);
        }

        .reminder-label svg {
            width: 1rem;
            height: 1rem;
        }
        

        /* Call Schedule Button */
        .call-schedule-btn {
            margin-top: 1rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        .call-schedule-btn:hover {
            background: linear-gradient(135deg, #e55c00, #cc5200);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 0, 0.4);
        }

        .call-schedule-btn svg {
            width: 1rem;
            height: 1rem;
        }

        /* History Item Styles */
        .history-item {
            background: rgba(255, 107, 0, 0.05);
            border: 1px solid rgba(255, 107, 0, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
        }

        .status-scheduled {
            background: #ff6b00;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Chat Input Area */
        .chat-input-area {
            padding: 1.5rem 2rem 2rem;
            border-top: 1px solid rgba(238, 238, 238, 0.8);
            background: rgba(255, 255, 255, 0.95);
        }

        .input-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        #messageInput {
            flex: 1;
            padding: 1rem 1.25rem;
            border: 2px solid rgba(238, 238, 238, 0.8);
            border-radius: 1.5rem;
            font-size: 0.875rem;
            color: #212121;
            background: #FFFFFF;
            transition: all 0.3s ease;
            outline: none;
            font-family: inherit;
        }

        #messageInput::placeholder {
            color: #BDBDBD;
        }

        #messageInput:focus {
            border-color: #ff6b00;
            box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
        }

        .send-button {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(255, 107, 0, 0.3);
        }

        .send-button:hover {
            background: linear-gradient(135deg, #e55c00, #cc5200);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4);
        }

        .send-icon {
            width: 1.25rem;
            height: 1.25rem;
            color: #FFFFFF;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 107, 0, 0.05);
            border: 1px solid rgba(255, 107, 0, 0.2);
            border-radius: 1.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: #ff6b00;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .quick-action-btn:hover {
            background: rgba(255, 107, 0, 0.1);
            border-color: rgba(255, 107, 0, 0.3);
            transform: translateY(-1px);
        }

        .quick-action-btn svg {
            width: 1rem;
            height: 1rem;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            width: 90%;
            max-width: 32rem;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        /* Changed Modal Icon for versatility */
        .modal-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #212121;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #424242;
            margin-bottom: 0.5rem;
        }
        
        .radio-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #424242;
            margin-right: 1.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(224, 224, 224, 0.8);
            border-radius: 0.75rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff6b00;
            box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-secondary {
            background: rgba(158, 158, 158, 0.1);
            color: #616161;
        }

        .btn-secondary:hover {
            background: rgba(158, 158, 158, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #e55c00, #cc5200);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 0, 0.4);
        }
        
        .reminder-type-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .reminder-type-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .reminder-type-option input {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #BDBDBD;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
        }
        
        .reminder-type-option input:checked {
            border-color: #ff6b00;
            background-color: #ff6b00;
        }
        
        .reminder-type-option input:checked::before {
            content: '';
            width: 0.6rem;
            height: 0.6rem;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .reminder-type-option label {
            font-size: 0.875rem;
            color: #424242;
            font-weight: 500;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 0;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: #BDBDBD;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* System Message Styles */
        .system-message {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 1001;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            max-width: 90%;
            text-align: center;
            font-family: 'Inter', sans-serif;
        }

        .system-message-success {
            background-color: #ff6b00;
            color: #FFFFFF;
        }

        .system-message-error {
            background-color: #ff6b00;
            color: #FFFFFF;
        }

        /* Animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideUpOut {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }

        /* Care Mode Toggle Styles */
        .care-mode-toggle {
            display: inline-flex;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 1rem;
            padding: 0.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(238, 238, 238, 0.8);
            margin: 0 auto;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .toggle-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.8rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: #616161;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            font-family: inherit;
        }

        .toggle-btn:hover {
            color: #ff6b00;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #ff6b00, #e55c00);
            color: #FFFFFF;
            box-shadow: 0 2px 8px rgba(255, 107, 0, 0.3);
        }

        .toggle-btn.active:hover {
            background: linear-gradient(135deg, #e55c00, #cc5200);
            color: #FFFFFF;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0.25rem;
            }
            
            .container {
                max-width: 100%;
            }
            
            .chat-card {
                height: 98vh;
                border-radius: 1.5rem;
                min-height: 600px;
            }
            
            .chat-header {
                padding: 1rem 1.5rem;
            }
            
            .chat-messages {
                padding: 1.5rem;
            }
            
            .chat-input-area {
                padding: 1rem 1.5rem 1.5rem;
            }
            
            .modal {
                width: 95%;
                padding: 1.5rem;
                max-width: 90vw;
            }
        }
    </style>
</head>
<body>
    <!-- Background decoration -->
    <div class="bg-decoration">
        <div class="decoration-circle circle-1"></div>
        <div class="decoration-circle circle-2"></div>
        <div class="decoration-circle circle-3"></div>
    </div>

    <div class="container">
        <!-- Main Chat Card -->
        <div class="chat-card">
            <!-- Header -->
            <div class="chat-header">
                <div class="header-left">
                    <div class="logo">
                        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2a10 10 0 0 0-9.84 8.21c.21 4.5 4 8.04 8.84 9.42a1 1 0 0 0 .5 0c4.84-1.38 8.63-4.92 8.84-9.42A10 10 0 0 0 12 2z"></path>
                            <path d="M12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zM15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                        </svg>
                    </div>
                    <div class="brand-info">
                        <h1 class="brand-name">Lifestyle AI</h1>
                        <p class="brand-subtitle">Your Personal Assistant</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="history-btn" id="chatHistoryBtn" title="Chat History">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"/>
                        </svg>
                    </button>
                    <button class="history-btn" id="historyBtn" title="Reminder History">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                    </button>
                    <div class="profile-icon" id="profileIcon">
                        <svg class="profile-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Care Mode Toggle -->
            <div class="flex flex-col items-center py-2 px-6">
                <div class="care-mode-toggle" id="careModeToggle">
                    <button class="toggle-btn active" data-mode="general">General Care</button>
                    <button class="toggle-btn" data-mode="personalized">Personalized Care</button>
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <div class="bot-avatar">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <h3>Welcome to Lifestyle AI</h3>
                        <p>I'm your AI assistant. How can I assist you today?</p>
                    </div>
                </div>
            </div>

            <!-- Chat Input Area -->
            <div class="chat-input-area">
                <div class="input-container">
                    <input type="text" id="messageInput" placeholder="Type your message here..." autocomplete="off"/>
                    <button type="button" id="sendButton" class="send-button">
                        <svg class="send-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                        </svg>
                    </button>
                </div>
                <div class="quick-actions" id="quickActions">
                    <!-- Quick actions will be dynamically loaded -->
                </div>
            </div>
        </div>
    </div>

    <!-- Call Schedule Modal -->
    <div class="modal-overlay" id="callModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                </div>
                <h2 class="modal-title">Schedule Reminder</h2>
            </div>
            
            <form id="callScheduleForm">
                
                <div class="form-group">
                    <label class="form-label" for="reminderType">Reminder Type</label>
                    <div class="reminder-type-group">
                        <div class="reminder-type-option">
                            <input type="radio" name="reminderType" id="typeCall" value="call" checked>
                            <label for="typeCall">Call</label>
                        </div>
                        <div class="reminder-type-option">
                            <input type="radio" name="reminderType" id="typeSMS" value="sms">
                            <label for="typeSMS">SMS</label>
                        </div>
                        <div class="reminder-type-option">
                            <input type="radio" name="reminderType" id="typeWhatsApp" value="whatsapp">
                            <label for="typeWhatsApp">WhatsApp</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="phoneNumber">Phone Number</label>
                    <input type="tel" id="phoneNumber" class="form-input" placeholder="+91 9876543210" required/>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="scheduledTime">Reminder Time</label>
                    <input type="datetime-local" id="scheduledTime" class="form-input" required/>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="patientName">Your Name</label>
                    <input type="text" id="patientName" class="form-input" placeholder="Enter your name" required/>
                </div>
            </form>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelCall">Cancel</button>
                <button type="button" class="btn btn-primary" id="scheduleCall">Schedule Reminder</button>
            </div>
        </div>
    </div>

    <!-- Include marked.js for Markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>
        // DOM Elements
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const quickActionButtons = document.querySelectorAll('.quick-action-btn');
        const callModal = document.getElementById('callModal');
        const scheduleCallBtn = document.getElementById('scheduleCall');
        const cancelCallBtn = document.getElementById('cancelCall');
        const callScheduleForm = document.getElementById('callScheduleForm');
        const historyBtn = document.getElementById('historyBtn');
        const profileIcon = document.getElementById('profileIcon');
        const careModeToggle = document.getElementById('careModeToggle');
        const quickActionsContainer = document.getElementById('quickActions');
        const chatHistoryBtn = document.getElementById('chatHistoryBtn');

        // Chat state
        let isTyping = false;
        let messageHistory = []; // Start fresh always
        let currentAIResponse = null;
        let currentCareMode = 'general';

        // Placeholder for n8n webhook URL
        const N8N_WEBHOOK_URL = 'https://n8n.example.com/webhook/your-unique-id';

        // Quick action messages based on mode
        const quickActions = {
            general: [
                { message: 'What is a healthy diet?', text: 'Healthy Diet', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>` },
                { message: 'Tips for better sleep', text: 'Better Sleep', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>` },
                { message: 'How to manage stress?', text: 'Stress Management', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 2a2 2 0 0 0-2 2v5H4a2 2 0 0 0-2 2v6c0 1.1.9 2 2 2h5v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-5h5a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-5V4a2 2 0 0 0-2-2h-6z"/></svg>` },
            ],
            personalized: [
                { message: 'What is a good diet for my body type?', text: 'Diet Plan', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>` },
                { message: 'Help me plan my fitness routine', text: 'Fitness Plan', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"/> <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"/></svg>` },
                { message: 'How can I improve my daily routine?', text: 'Daily Routine', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 2a2 2 0 0 0-2 2v5H4a2 2 0 0 0-2 2v6c0 1.1.9 2 2 2h5v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-5h5a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-5V4a2 2 0 0 0-2-2h-6z"/></svg>` },
            ],
        };
        
        // This is the correct API key for the Gemini API
        const GEMINI_API_KEY = "AIzaSyCls0wEiOJU4yrUxD0fU7ShxPQJz9ghOaQ";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;

        // Simple Local Storage for Demo
        class LifestyleStorage {
            constructor() {
                this.storageKey = 'lifestyle_data';
            }
            
            saveCall(callData) {
                const calls = this.getCalls();
                calls.push({
                    id: Date.now(),
                    ...callData,
                    status: 'scheduled',
                    createdAt: new Date().toISOString()
                });
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(calls));
                } catch (e) {
                    console.error('Storage error:', e);
                }
            }
            
            getCalls() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error('Storage retrieval error:', e);
                    return [];
                }
            }
            
            getCallHistory() {
                return this.getCalls().slice(-10); // Last 10 calls
            }
        }

        // Initialize storage
        const storage = new LifestyleStorage();

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            focusMessageInput();
            setMinDateTime();
            updateSendButtonState();
            updateQuickActions();
            loadChatHistory(); // Load chat history based on context
            console.log('ðŸŒŸ Lifestyle AI Assistant Initialized');
        });

        // Event Listeners
        function initializeEventListeners() {
            // Send message events
            sendButton.addEventListener('click', handleSendMessage);
            messageInput.addEventListener('keypress', handleKeyPress);
            messageInput.addEventListener('input', handleInputChange);

            // Care mode toggle
            careModeToggle.addEventListener('click', handleModeToggle);

            // Modal events
            cancelCallBtn.addEventListener('click', closeCallModal);
            scheduleCallBtn.addEventListener('click', handleScheduleCall);
            callModal.addEventListener('click', (e) => {
                if (e.target === callModal) closeCallModal();
            });

            // History buttons
            historyBtn.addEventListener('click', showCallHistory);
            chatHistoryBtn.addEventListener('click', () => {
                // Save current session before navigating
                if (messageHistory.length > 0) {
                    const allHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
                    allHistory.push(...messageHistory);
                    localStorage.setItem('chatHistory', JSON.stringify(allHistory));
                }
                window.location.href = 'chat-history.html';
            });

            // Profile link
            profileIcon.addEventListener('click', () => {
                window.location.href = 'user-profile.html';
            });

            // Keyboard navigation
            document.addEventListener('keydown', handleKeyboardNavigation);
        }

        // Phone Number Validation
        function validatePhoneNumber(phone) {
            const indianPhoneRegex = /^(\+91|91)?[6-9]\d{9}$/;
            return indianPhoneRegex.test(phone.replace(/\s/g, ''));
        }

        // Form Validation
        function validateCallForm() {
            const phone = document.getElementById('phoneNumber').value.trim();
            const time = document.getElementById('scheduledTime').value;
            const name = document.getElementById('patientName').value.trim();
            
            if (!name) {
                showMessage('Please enter your name', 'error');
                return false;
            }
            
            if (!validatePhoneNumber(phone)) {
                showMessage('Please enter a valid Indian phone number', 'error');
                return false;
            }
            
            const scheduledDate = new Date(time);
            const now = new Date();
            
            if (scheduledDate <= now) {
                showMessage('Please select a future date and time', 'error');
                return false;
            }
            
            return true;
        }

        // Message handling
        async function handleSendMessage() {
            const message = messageInput.value.trim();
            if (message && !isTyping) {
                sendUserMessage(message);
                messageInput.value = '';
                updateSendButtonState();
                await getAIResponse(message);
            }
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        }

        function handleInputChange() {
            updateSendButtonState();
        }

        function updateSendButtonState() {
            const hasText = messageInput.value.trim().length > 0;
            sendButton.disabled = !hasText || isTyping;

            if (hasText && !isTyping) {
                sendButton.style.opacity = '1';
                sendButton.style.transform = 'scale(1)';
            } else {
                sendButton.style.opacity = '0.6';
                sendButton.style.transform = 'scale(0.95)';
            }
        }

        function sendUserMessage(message) {
            addMessage(message, 'user');
            messageHistory.push({ role: 'user', content: message, timestamp: new Date().toISOString() });
        }
        
        // Handle mode toggle
        function handleModeToggle(e) {
            const target = e.target;
            if (target.classList.contains('toggle-btn')) {
                document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                target.classList.add('active');
                currentCareMode = target.dataset.mode;
                updateChatInterface();
                updateQuickActions();
            }
        }
        
        // Update welcome message and quick actions
        function updateChatInterface() {
            // Clear current messages but keep loaded history if any
            if (messageHistory.length === 0) {
                chatMessages.innerHTML = '';
                let welcomeMessage = "Hello! I can provide general health and wellness advice. What would you like to know about?";
                if (currentCareMode === 'personalized') {
                    welcomeMessage = "Hello! I'm your personal AI lifestyle assistant. How can I help you today?";
                }
                const initialMessageDiv = document.createElement('div');
                initialMessageDiv.className = 'welcome-message';
                initialMessageDiv.innerHTML = `
                    <div class="bot-avatar">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <h3>Welcome to Lifestyle AI</h3>
                        <p>${welcomeMessage}</p>
                    </div>
                `;
                chatMessages.appendChild(initialMessageDiv);
            }
        }

        // Update quick actions
        function updateQuickActions() {
            quickActionsContainer.innerHTML = '';
            const actions = quickActions[currentCareMode];
            actions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'quick-action-btn';
                button.innerHTML = `${action.icon} ${action.text}`;
                button.setAttribute('data-message', action.message);
                button.addEventListener('click', handleQuickAction);
                quickActionsContainer.appendChild(button);
            });
        }
        
        // AI Response Function
        async function getAIResponse(userMessage) {
            showTypingIndicator();

            let retries = 0;
            const maxRetries = 3;
            const baseDelay = 1000;

            let systemPrompt = '';
            if (currentCareMode === 'general') {
                systemPrompt = "You are a general health and wellness assistant. Provide concise, safe, and positive advice. Do not act as a medical professional. Stick to general knowledge.";
            } else {
                systemPrompt = "You are a personalized lifestyle assistant. Your responses should be empathetic, positive, and tailored, offering actionable advice based on user goals. Always include a call to action at the end to schedule a reminder. Do not act as a medical professional. Stick to general knowledge.";
            }
            
            const payload = {
                contents: [{ parts: [{ text: userMessage }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            while (retries < maxRetries) {
                try {
                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't generate a response. Please try again.";
                        hideTypingIndicator();
                        
                        // Check if response is from personalized mode and includes a call to action
                        const canSchedule = currentCareMode === 'personalized' && botResponse.toLowerCase().includes('reminder');
                        
                        addMessage(botResponse, 'bot', canSchedule);
                        messageHistory.push({ role: 'assistant', content: botResponse, timestamp: new Date().toISOString() });
                        
                        // Store AI response for scheduling
                        currentAIResponse = {
                            userQuery: userMessage,
                            aiResponse: botResponse
                        };

                        return;
                    } else if (response.status === 429) {
                        retries++;
                        const delay = baseDelay * Math.pow(2, retries);
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`API error: ${response.status}`);
                    }
                } catch (error) {
                    console.error('Error fetching AI response:', error);
                    retries++;
                    const delay = baseDelay * Math.pow(2, retries);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            hideTypingIndicator();
            addMessage("I'm having trouble connecting to the AI assistant. Please try again later.", 'bot');
        }

        function addMessage(content, sender, canScheduleCall = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${sender}`;

            const avatarIcon = sender === 'bot' ?
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>` :
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                </svg>`;

            avatar.innerHTML = avatarIcon;

            const bubble = document.createElement('div');
            bubble.className = `message-bubble ${sender}`;
            bubble.innerHTML = marked.parse(content);

            // Add call scheduling button for bot messages with health advice
            if (canScheduleCall && sender === 'bot') {
                const callButton = document.createElement('button');
                callButton.className = 'call-schedule-btn';
                callButton.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                    Schedule Reminder
                `;
                callButton.addEventListener('click', openCallModal);
                bubble.appendChild(callButton);
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        // Load chat history - only when specifically requested from history page
        function loadChatHistory() {
            const urlParams = new URLSearchParams(window.location.search);
            const shouldLoad = urlParams.get('load');
            
            if (shouldLoad) {
                try {
                    const tempHistory = localStorage.getItem('tempChatHistory');
                    if (tempHistory) {
                        messageHistory = JSON.parse(tempHistory);
                        localStorage.removeItem('tempChatHistory'); // Clear temp storage
                        
                        // Render loaded messages
                        chatMessages.innerHTML = '';
                        messageHistory.forEach(msg => {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.role === 'user' ? 'user' : 'bot'}`;
                            const avatar = document.createElement('div');
                            avatar.className = `message-avatar ${msg.role === 'user' ? 'user' : 'bot'}`;
                            const avatarIcon = msg.role === 'bot' ?
                                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>` :
                                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`;
                            avatar.innerHTML = avatarIcon;
                            const bubble = document.createElement('div');
                            bubble.className = `message-bubble ${msg.role === 'user' ? 'user' : 'bot'}`;
                            bubble.innerHTML = marked.parse(msg.content);
                            messageDiv.appendChild(avatar);
                            messageDiv.appendChild(bubble);
                            chatMessages.appendChild(messageDiv);
                        });
                        scrollToBottom();
                        
                        // Clear URL parameter
                        window.history.replaceState({}, document.title, window.location.pathname);
                        return;
                    }
                } catch (e) {
                    console.error("Failed to load temporary chat history.", e);
                }
            }
            
            // Show fresh welcome message if no history loaded
            updateChatInterface();
        }

        // Call History
        function showCallHistory() {
            const calls = storage.getCalls();
            let historyHTML = '<h3>ðŸ“± Recent Reminders</h3>';
            
            if (calls.length === 0) {
                historyHTML += '<p>No reminders scheduled yet.</p>';
            } else {
                calls.forEach(call => {
                    const typeIcon = call.reminderType === 'call' ? 'ðŸ“ž' : 
                                   call.reminderType === 'whatsapp' ? 'ðŸ’¬' : 'ðŸ“±';
                    const typeLabel = call.reminderType === 'call' ? 'Call' : 
                                    call.reminderType === 'whatsapp' ? 'WhatsApp' : 'SMS';
                    
                    historyHTML += `
                        <div class="history-item">
                            <strong>ðŸ‘¤ ${call.patientName}</strong><br>
                            ${typeIcon} ${call.phoneNumber} (${typeLabel})<br>
                            â° ${new Date(call.scheduledTime).toLocaleString()}<br>
                            <span class="status-scheduled">Scheduled</span>
                        </div>
                    `;
                });
            }
            
            addMessage(historyHTML, 'bot');
        }

        // Modal Functions
        function openCallModal() {
            callModal.classList.add('active');
            document.getElementById('phoneNumber').focus();
        }

        function closeCallModal() {
            callModal.classList.remove('active');
            callScheduleForm.reset();
        }

        function setMinDateTime() {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            const localTime = new Date(now.getTime() - offset);
            const minDateTime = localTime.toISOString().slice(0, 16);
            document.getElementById('scheduledTime').min = minDateTime;
        }

        // Call Scheduling Function
        async function handleScheduleCall() {
            if (!validateCallForm()) return;

            const reminderType = document.querySelector('input[name="reminderType"]:checked').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const scheduledTime = document.getElementById('scheduledTime').value;
            const patientName = document.getElementById('patientName').value;
            
            const payload = {
                phoneNumber,
                scheduledTime,
                patientName,
                reminderType,
                userQuery: currentAIResponse.userQuery || '',
                aiResponse: currentAIResponse.aiResponse || ''
            };

            try {
                const response = await scheduleCallViaWebhook(payload);
                
                if (response.success) {
                    storage.saveCall({ phoneNumber, scheduledTime, patientName, reminderType });

                    const reminderTypeText = reminderType === 'call' ? 'Voice call' : 
                                           reminderType === 'whatsapp' ? 'WhatsApp message' : 'SMS';
                    showMessage(`${reminderTypeText} reminder scheduled successfully!`, 'success');
                    closeCallModal();
                    
                    const confirmationMessage = `âœ… **${reminderTypeText} Reminder Scheduled**
                    
ðŸ“ž **Phone:** ${phoneNumber}
â° **Time:** ${new Date(scheduledTime).toLocaleString()}
ðŸ‘¤ **Name:** ${patientName}
ðŸ“± **Type:** ${reminderType.toUpperCase()}
<p>I'll send you a ${reminderTypeText.toLowerCase()} with personalized reminders. Stay healthy! ðŸŒŸ</p>`;
                    addMessage(confirmationMessage, 'bot');
                } else {
                    throw new Error(response.message || 'Failed to schedule reminder');
                }
            } catch (error) {
                console.error('Error scheduling reminder:', error);
                showMessage('Failed to schedule reminder. Please try again.', 'error');
            }
        }

        // Webhook Function to send data to n8n
        async function scheduleCallViaWebhook(payload) {
            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                console.log('âœ… Webhook payload sent successfully:', payload);
                return { success: true, message: 'Reminder scheduled successfully!' };
                
            } catch (error) {
                console.error('Webhook error:', error);
                return { success: false, message: error.message };
            }
        }

        function showTypingIndicator() {
            isTyping = true;
            updateSendButtonState();
            
            const existingIndicator = document.getElementById('typing-indicator');
            if (existingIndicator) return;

            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot typing-indicator';
            typingDiv.id = 'typing-indicator';

            typingDiv.innerHTML = `
                <div class="message-avatar bot">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="message-bubble bot">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            isTyping = false;
            updateSendButtonState();

            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Quick Actions
        function handleQuickAction(e) {
            const message = e.currentTarget.getAttribute('data-message');
            messageInput.value = message;
            messageInput.focus();
            updateSendButtonState();

            e.currentTarget.style.transform = 'scale(0.95)';
            setTimeout(() => {
                e.currentTarget.style.transform = 'scale(1)';
            }, 150);
        }

        // Utility Functions
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function focusMessageInput() {
            messageInput.focus();
        }

        function handleKeyboardNavigation(e) {
            if (e.key === 'Escape' && callModal.classList.contains('active')) {
                closeCallModal();
            }
        }

        // Enhanced Message Display Function
        function showMessage(message, type) {
            const existingMessage = document.querySelector('.system-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageElement = document.createElement('div');
            messageElement.className = `system-message system-message-${type}`;
            messageElement.textContent = message;
            messageElement.style.animation = 'slideDown 0.3s ease-out';

            document.body.appendChild(messageElement);

            setTimeout(() => {
                messageElement.style.animation = 'slideUpOut 0.3s ease-in forwards';
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.remove();
                    }
                }, 300);
            }, 4000);
        }

        // Enhanced input interactions
        messageInput.addEventListener('focus', () => {
            if (messageInput && messageInput.parentElement) {
                messageInput.parentElement.style.transform = 'scale(1.02)';
                messageInput.parentElement.style.transition = 'transform 0.2s ease';
            }
        });

        messageInput.addEventListener('blur', () => {
            if (messageInput && messageInput.parentElement) {
                messageInput.parentElement.style.transform = 'scale(1)';
            }
        });
    </script>
</body>
</html>